<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AgriculThor - Registrar Cosecha</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="img/logo.png" type="image/png" />
  <style>
    .sim-resultado {
      margin-top: 2rem;
      background-color: #f0f8ff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>
  <!-- Barra de navegaci√≥n -->
  <nav>
    <ul class="navbar">
      <li class="logo-container">
        <a href="pagina2.html">
          <img src="img/amarillo.png" alt="AgriculThor Logo" class="logo" />
        </a>
      </li>
      <li><a href="pagina3.html">Clima</a></li>
      <li><a href="pagina4.html">Precios</a></li>
      <li><a href="pagina5.html">Alertas</a></li>
      <li><a href="pagina6.html">Registrar Cosecha</a></li>
      <li><a href="pagina7.html">Recomendaciones</a></li>
      <li><a href="pagina8.html">Mapa</a></li>
      <li id="logout-container" style="margin-left: auto;">
        <button onclick="cerrarSesion()" class="logout-btn">Cerrar sesi√≥n</button>
      </li>
    </ul>
  </nav>

  <main class="container">
    <h1>Registrar y Simular tu Cosecha</h1>

    <!-- Formulario combinado para registrar y simular cosecha -->
    <form id="cosechaForm">
      <label for="tipoCultivo">Tipo de cultivo:</label>
      <input type="text" id="tipoCultivo" value="Papa" readonly />

      <label for="hectareas">√Årea sembrada (ha):</label>
      <input type="number" id="hectareas" min="0.1" step="0.1" required>

      <label for="rendimiento">Rendimiento estimado (ton/ha):</label>
      <input type="number" id="rendimiento" value="30" step="0.1" required>

      <label for="precioKg">Precio estimado de venta (COP/kg):</label>
      <input type="number" id="precioKg" value="1200" step="50" required>

      <label for="fechaSiembra">Fecha de siembra:</label>
      <input type="date" id="fechaSiembra" required />

      <p id="fechaRecoEstimado" style="font-weight:bold; margin-top:1rem;"></p>

      <button type="submit">Registrar y Simular</button>
      <p id="mensajeRegistro" class="success-msg"></p>
    </form>

    <div id="resultadoSimulacion" class="sim-resultado" style="display:none;"></div>

    <!-- Tabla para mostrar las cosechas guardadas -->
    <h2 style="margin-top: 2rem;">Tus Cosechas Registradas</h2>
    <table id="tablaCosechas">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Cantidad (kg)</th>
          <th>Fecha Siembra</th>
          <th>Fecha Recolecci√≥n</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="borrarHistorial()" class="logout-btn" style="margin-top: 1.5rem;">üóë Borrar historial de cosechas</button>
  </main>

  <script>
    const cosechaForm = document.getElementById('cosechaForm');
    const mensajeRegistro = document.getElementById('mensajeRegistro');
    const resultadoDiv = document.getElementById('resultadoSimulacion');
    const fechaRecoEstimado = document.getElementById('fechaRecoEstimado');
    const fechaSiembraInput = document.getElementById('fechaSiembra');

    fechaSiembraInput.addEventListener('change', () => {
      const fechaSiembra = new Date(fechaSiembraInput.value);
      const fechaCosecha = new Date(fechaSiembra);
      fechaCosecha.setDate(fechaSiembra.getDate() + 120);
      const estimada = fechaCosecha.toISOString().split('T')[0];
      fechaRecoEstimado.textContent = `üìÖ Fecha estimada de recolecci√≥n: ${estimada}`;
    });

    cosechaForm.addEventListener('submit', e => {
      e.preventDefault();

      const tipoCultivo = document.getElementById('tipoCultivo').value;
      const hectareas = parseFloat(document.getElementById('hectareas').value);
      const rendimiento = parseFloat(document.getElementById('rendimiento').value);
      const precioKg = parseFloat(document.getElementById('precioKg').value);
      const fechaSiembra = new Date(fechaSiembraInput.value);
      const fechaRecoleccion = new Date(fechaSiembra);
      fechaRecoleccion.setDate(fechaSiembra.getDate() + 120);

      const produccionEstimada = hectareas * rendimiento * 1000; // en kg
      const valorTotal = produccionEstimada * precioKg;

      const cosecha = {
        tipoCultivo,
        cantidad: produccionEstimada,
        fechaSiembra: fechaSiembra.toISOString().split('T')[0],
        fechaRecoleccion: fechaRecoleccion.toISOString().split('T')[0],
      };

      let registros = JSON.parse(localStorage.getItem('registrosCosecha')) || [];
      registros.push(cosecha);
      localStorage.setItem('registrosCosecha', JSON.stringify(registros));

      const simulacion = {
        hectareas,
        fechaSiembra: cosecha.fechaSiembra,
        fechaCosecha: cosecha.fechaRecoleccion,
        rendimiento,
        produccionEstimada,
        precioKg,
        valorTotal
      };

      localStorage.setItem('simulacionCosecha', JSON.stringify(simulacion));

      mensajeRegistro.textContent = '‚úÖ Cosecha registrada y simulaci√≥n guardada exitosamente.';
      mensajeRegistro.classList.remove('error-msg');
      mensajeRegistro.classList.add('success-msg');

      mostrarCosechas();
      resultadoDiv.innerHTML = `
        <h3>Resultados de la Simulaci√≥n</h3>
        <p><strong>Fecha estimada de cosecha:</strong> ${simulacion.fechaCosecha}</p>
        <p><strong>Producci√≥n estimada:</strong> ${produccionEstimada.toLocaleString()} kg</p>
        <p><strong>Valor estimado total:</strong> $${valorTotal.toLocaleString()}</p>
      `;
      resultadoDiv.style.display = 'block';

      cosechaForm.reset();
      document.getElementById('tipoCultivo').value = 'Papa';
      fechaRecoEstimado.textContent = '';
    });

    function mostrarCosechas() {
      const registros = JSON.parse(localStorage.getItem('registrosCosecha')) || [];
      const tbody = document.querySelector('#tablaCosechas tbody');
      tbody.innerHTML = '';

      registros.forEach(item => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td>${item.tipoCultivo}</td>
          <td>${item.cantidad}</td>
          <td>${item.fechaSiembra}</td>
          <td>${item.fechaRecoleccion}</td>
        `;
        tbody.appendChild(fila);
      });
    }

    function borrarHistorial() {
      if (confirm('¬øEst√°s seguro de borrar todas las cosechas registradas?')) {
        localStorage.removeItem('registrosCosecha');
        mostrarCosechas();
        mensajeRegistro.textContent = 'üóë Historial borrado correctamente.';
        mensajeRegistro.classList.remove('error-msg');
        mensajeRegistro.classList.add('success-msg');
      }
    }

    function cerrarSesion() {
      localStorage.removeItem('agriculthorUser');
      localStorage.removeItem('registrosCosecha');
      localStorage.removeItem('simulacionCosecha');
      window.location.href = 'index.html';
    }

    document.addEventListener('DOMContentLoaded', mostrarCosechas);
  </script>
</body>

</html>


